
<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <title>Balanced - Payments processing, escrow, and payouts in one simple API</title>
      <link rel="shortcut icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAB50RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNS4xqx9I6wAAAStJREFUWIXtlT1SwzAQRp+YHMAeGsrcIGlc4yukpDHODaBLF6dzB5yAkIYyOYJSu/INUtIw9g1MgZhhZJlITogbfZ12Pu2+0c+uaJqGIXU1aHUP4AGAkR4QQlDF0Rh4BWKgBl5CWWQuiRebyROQAgEggXmelAf913WdwFYVRyVYVnGUOhRPgQe1F5Vra/K2AKo4CoCpwXtvC9DhnS42k/FRgD9Un+rNk/JwFCCURc33nel6cwAweXcmY9cJzICVApHALJSFMYFJeVLuVI6f/c/A3OQV+qsUQtjW6SXbX3AxeQAP4AFa09BWH+/XGXCrlvubu8+sT55ejUgVX2rhlQ3EuRqRadq5TMuTAQLL2L8BmAaT9bA6B8AjsP61XquYs1qP8NIavA94AA/wBRJiTbdsTuB4AAAAAElFTkSuQmCC" type="image/x-icon">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
      <link href="/static/css/styles.css" rel="stylesheet">
      <!--<link href="static/css/pygments.css" rel="stylesheet">-->
      <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
      <!--[if lt IE 9]>

     <!-- <script src="static/js/html5shiv.js"></script> -->
      <![endif]-->
  </head>

  <body data-spy="scroll" data-target=".sidebar-nav" data-offset="10">

    <header class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="row">
            <div class="logo">
              <a class="brand" href="https://www.balancedpayments.com"></a>
            </div>
            <div class="span16">
              <ul class="nav nav-api-context">
                <li class="dropdown">
                  <a class="dropdown-toggle context api-context" data-toggle="dropdown" id="context-dropdown-head">
                    <div id="logo"></div>
                    Overview
                    <b class="caret"></b>
                  </a>
                  <ul class="dropdown-menu context">
                    <li>
                      <a class="context-change" data-context="api" href="/1.1/api/">API Reference</a>
                    </li>
                    <li>
                      <a class="context-change" data-context="faq" href="https://support.balancedpayments.com/hc/en-us">FAQ</a>
                    </li>
                  </ul>
                </li>
              </ul>

              <ul class="nav nav-api-version">
                <li class="dropdown">
                  <a class="dropdown-toggle version api-version" data-toggle="dropdown" id="version-dropdown-head">v 1.1
                    <b class="caret"></b>
                  </a>
                  <ul class="dropdown-menu version">
                    <li>
                      <a class="version-change" data-version="1.0" href="/1.0/overview/">v 1.0</a>
                    </li>
                  </ul>
                </li>
              </ul>

              <ul class="nav nav-api-clients">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle lang" id="lang-dropdown-head" data-toggle="dropdown">lang: cURL <b class="caret"></b></a>
                  <ul class="dropdown-menu lang">
                    <li><a class="lang-change" data-lang="ruby" href="#">Ruby</a></li>
                    <li><a class="lang-change" data-lang="python" href="#">Python</a></li>
                    <li><a class="lang-change" data-lang="node" href="#">Node.js</a></li>
                    <li><a class="lang-change" data-lang="php" href="#">PHP</a></li>
                    <li><a class="lang-change" data-lang="java" href="#">Java</a></li>
                    <li><a class="lang-change" data-lang="bash" href="#">cURL</a></li>
                  </ul>
                </li>
              </ul>
            </div>
            <ul class="nav nav-links pull-right">
              <li>
                <a href="/1.1/overview/#support">Help</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <div class="api-version-rev">
      
      <div class="container content" id="overview-content">
        <div class="row">

          <div id="sidebar-top" style="display:none">
            <div id="sidebar-top-content">
              <ul class="inline">
                <li style="vertical-align: middle;">
                  <div id="logo" style="background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAUCAMAAAC+oj0CAAAAV1BMVEVymix4oi/vQDXjPDJ4oi94oi/vQDXvQDXvQDXvQDV4oi91ni7vQDXqPjN4oi/foRLanRHopxNznC3mPTPopxPopxMAAABwmCzgPDHanRHopxN4oi/vQDXwPhJhAAAAF3RSTlPbICDbYBBQYEAQgLOAs1DH7hDHx6CAAHwvTFAAAABmSURBVHja1cjXDYAwDABR01sCpAEh2X9ObCFkJLMA93cPSpcPtb0a92QLqDLWsdYJA8iUY7aJulkzTzdr4p55Jp1gUM61uOzWjg1sn/2Iw7IEyeHEguCVeBUciaNgT+wFG49qnrsAe+cllBc1FLYAAAAASUVORK5CYII=) no-repeat center;width: 25px;height: 25px;float: left;">
                  </div>
                </li>
                <li id="context-title" style="font-size: 16px;">Overview</li>
              </ul>
              <div class="clearfix"></div>
            </div>
          </div>

          <div class="span6 context-sidebar">
            <div class="sidebar-nav" data-spy="affix">
              <div class="row">
                <div class="span6">
                  <div class="nav nav-list context-navlist">
                    <!-- The table of contents menu -->
                    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/#feature-requests">Feature Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/#support">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/#submission-delivery-times">Submission &amp; Delivery times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/#pricing">Pricing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/#transaction-limits">Transaction Limits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/getting-started/">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/getting-started/#start-integrating">Start Integrating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/getting-started/#client-libraries">Client Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/getting-started/#third-party-plugins">Third-Party Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/getting-started/#integration-assistance">Integration Assistance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/best-practices/">Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/best-practices/#use-balanced-js">Use balanced.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/best-practices/#reducing-declined-transactions">Reducing Declined Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/best-practices/#catching-fraud-early">Catching Fraud Early</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/best-practices/#reducing-payout-delays">Reducing Payout Delays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/best-practices/#use-meta">Use Meta</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/resources/">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#test-credit-card-numbers">Test credit card numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#test-bank-account-numbers">Test bank account numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#testing-customer-identity-verification">Testing Customer identity verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#funding-instrument-fingerprint">Funding Instrument Fingerprint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#address-verification-service">Address Verification Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#card-verification-value">Card Verification Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview/resources/#changelog">1.1 Changelog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart/">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../escrow/">Understanding Escrow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../balanced-js/">Using balanced.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debits/">Working with Debits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../credits/">Working with Credits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cardholds/">Working with Card Holds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../">Orders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collecting-fees/">Collecting Fees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../taxes/">Handling Taxes</a></li>
</ul>
</li>
</ul>

                    
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="context-content" class="span19 offset1">
            
  <section id="creating-a-simple-order">
<h1>Creating a Simple Order<a class="headerlink" href="#creating-a-simple-order" title="Permalink to this headline">∵</a></h1>
<p>API References:</p>
<ul class="list-noindent simple">
<li><a class="reference external" href="/1.1/api/customers/#create-a-customer">Create a Customer</a></li>
<li><a class="reference external" href="/1.1/api/bank-accounts/#create-a-bank-account-direct">Create a Bank Account (Direct)</a></li>
<li><a class="reference external" href="/1.1/api/orders/#create-an-order">Create an Order</a></li>
<li><a class="reference external" href="/1.1/api/orders/#update-an-order">Update an Order</a></li>
<li><a class="reference external" href="/1.1/api/credits/#create-a-credit">Create a Credit</a></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>By the end of this guide, you should understand how to do following:</p>
<ul class="list-noindent simple">
<li>* Create a <span class="docutils literal"><code>Customer</code></span> representing a seller (merchant) and associate a <span class="docutils literal"><code>BankAccount</code></span> to it.</li>
<li>* Create a <span class="docutils literal"><code>Customer</code></span> representing a buyer and associate a <span class="docutils literal"><code>BankAccount</code></span> to it.</li>
<li>* Create an <span class="docutils literal"><code>Order</code></span></li>
<li>* Update an <span class="docutils literal"><code>Order</code></span></li>
<li>* Create an order debit</li>
<li>* Check the order <span class="docutils literal"><code>amount</code></span></li>
<li>* Check the order <span class="docutils literal"><code>amount_escrowed</code></span></li>
<li>* Issue a credit from an <span class="docutils literal"><code>Order</code></span> to a seller</li>
<li>* Issue a credit from an <span class="docutils literal"><code>Order</code></span> to the marketplace bank account</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Let's begin by creating a <span class="docutils literal"><code>Customer</code></span> that represents our merchant.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">merchant</span> <span class="o">=</span> <span class="no">Balanced</span><span class="o">::</span><span class="no">Customer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Henry Ford&#39;</span><span class="p">,</span>
  <span class="ss">:dob_month</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span>
  <span class="ss">:dob_year</span> <span class="o">=&gt;</span> <span class="mi">1963</span><span class="p">,</span>
  <span class="ss">:address</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:postal_code</span> <span class="o">=&gt;</span> <span class="s1">&#39;48120&#39;</span>
  <span class="p">}</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">merchant</span> <span class="o">=</span> <span class="n">balanced</span><span class="o">.</span><span class="n">Customer</span><span class="p">(</span>
  <span class="n">dob_year</span><span class="o">=</span><span class="mi">1963</span><span class="p">,</span>
  <span class="n">dob_month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
  <span class="n">name</span><span class="o">=</span><span class="s">&#39;Henry Ford&#39;</span><span class="p">,</span>
  <span class="n">address</span><span class="o">=</span><span class="p">{</span>
    <span class="s">&#39;postal_code&#39;</span><span class="p">:</span> <span class="s">&#39;48120&#39;</span>
  <span class="p">}</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre>curl https://api.balancedpayments.com/customers <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;name=Henry Ford&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;dob_year=1963&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;dob_month=7&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;address[postal_code]=48120&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$marketplace</span> <span class="o">=</span> <span class="nx">\Balanced\Marketplace</span><span class="o">::</span><span class="na">mine</span><span class="p">();</span>
<span class="nv">$merchant</span> <span class="o">=</span> <span class="nv">$marketplace</span><span class="o">-&gt;</span><span class="na">customers</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;dob_month&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dob_year&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;1963&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Henry Ford&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address&quot;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s2">&quot;postal_code&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;48120&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">));</span>

<span class="nv">$order</span> <span class="o">=</span> <span class="nv">$merchant</span><span class="o">-&gt;</span><span class="na">orders</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Next, add a bank account to the merchant. In this guide we will tokenize the
bank account directly, however, balanced.js should be used to tokenize bank
accounts in production. Refer to the balanced.js guide for more
information on implementing balanced.js in your application.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">bank_account</span> <span class="o">=</span> <span class="no">Balanced</span><span class="o">::</span><span class="no">BankAccount</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Henry Ford&#39;</span><span class="p">,</span>
  <span class="ss">:routing_number</span> <span class="o">=&gt;</span> <span class="s1">&#39;321174851&#39;</span><span class="p">,</span>
  <span class="ss">:account_number</span> <span class="o">=&gt;</span> <span class="s1">&#39;0987654321&#39;</span><span class="p">,</span>
  <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s1">&#39;checking&#39;</span>
<span class="p">)</span>

<span class="n">bank_account</span><span class="o">.</span><span class="n">associate_to_customer</span><span class="p">(</span><span class="n">merchant</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">bank_account</span> <span class="o">=</span> <span class="n">balanced</span><span class="o">.</span><span class="n">BankAccount</span><span class="p">(</span>
  <span class="n">routing_number</span><span class="o">=</span><span class="s">&#39;121000358&#39;</span><span class="p">,</span>
  <span class="nb">type</span><span class="o">=</span><span class="s">&#39;checking&#39;</span><span class="p">,</span>
  <span class="n">account_number</span><span class="o">=</span><span class="s">&#39;9900000001&#39;</span><span class="p">,</span>
  <span class="n">name</span><span class="o">=</span><span class="s">&#39;Henry Ford&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">bank_account</span><span class="o">.</span><span class="n">associate_to</span><span class="p">(</span><span class="n">merchant</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># create bank account</span>
curl https://api.balancedpayments.com/bank_accounts <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;routing_number=121000358&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;type=checking&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;name=Henry Ford&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;account_number=9900000001&quot;</span>

<span class="c"># associate bank account to customer</span>
<span class="c"># bank_account_id: use id attribute from bank account created previously</span>
curl https://api.balancedpayments.com/bank_accounts/:bank_account_id <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -X PUT <span class="se">\</span>
     -d <span class="s2">&quot;customer=/customers/CU54L5eAjiumsNS6RMzbEedW&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$bank_account</span> <span class="o">=</span> <span class="nv">$marketplace</span><span class="o">-&gt;</span><span class="na">bank_accounts</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
<span class="s2">&quot;account_number&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;9900000001&quot;</span><span class="p">,</span>
<span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Johann Bernoulli&quot;</span><span class="p">,</span>
<span class="s2">&quot;routing_number&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;121000358&quot;</span><span class="p">,</span>
<span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;checking&quot;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$bank_account</span><span class="o">-&gt;</span><span class="na">associateToCustomer</span><span class="p">(</span><span class="nv">$merchant</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Now create a buyer and add a card to it. Again, in this guide we will tokenize
the card directly, however, balanced.js should be used to tokenize credit cards
in production. Refer to the balanced.js guide for more information on
implementing balanced.js in your application.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">buyer</span> <span class="o">=</span> <span class="no">Balanced</span><span class="o">::</span><span class="no">Customer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Buyer&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span>

<span class="n">card</span> <span class="o">=</span> <span class="no">Balanced</span><span class="o">::</span><span class="no">Card</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="s1">&#39;5105105105105100&#39;</span><span class="p">,</span>
  <span class="ss">:expiration_month</span> <span class="o">=&gt;</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span>
  <span class="ss">:expiration_year</span> <span class="o">=&gt;</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span>
  <span class="ss">:cvv</span> <span class="o">=&gt;</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span>
  <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Buyer&#39;</span>
<span class="p">)</span>

<span class="n">card</span><span class="o">.</span><span class="n">associate_to_customer</span><span class="p">(</span><span class="n">buyer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">buyer</span> <span class="o">=</span> <span class="n">balanced</span><span class="o">.</span><span class="n">Customer</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s">&#39;John Buyer&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">card</span> <span class="o">=</span> <span class="n">balanced</span><span class="o">.</span><span class="n">Card</span><span class="p">(</span>
  <span class="n">expiration_month</span><span class="o">=</span><span class="s">&#39;12&#39;</span><span class="p">,</span>
  <span class="n">security_code</span><span class="o">=</span><span class="s">&#39;123&#39;</span><span class="p">,</span>
  <span class="n">number</span><span class="o">=</span><span class="s">&#39;5105105105105100&#39;</span><span class="p">,</span>
  <span class="n">expiration_year</span><span class="o">=</span><span class="s">&#39;2020&#39;</span><span class="p">,</span>
  <span class="n">name</span><span class="o">=</span><span class="s">&#39;John Buyer&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">card</span><span class="o">.</span><span class="n">associate_to</span><span class="p">(</span><span class="n">buyer</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># create buyer</span>
curl https://api.balancedpayments.com/customers <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;name=John Buyer&quot;</span>

<span class="c"># create card</span>
curl https://api.balancedpayments.com/cards <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;expiration_month=12&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;security_code=123&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;number=5105105105105100&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;expiration_year=2020&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;name=John Buyer&quot;</span>

<span class="c"># associate card to customer.</span>
<span class="c"># card_id: the id attribute of the card created previously</span>
<span class="c"># customer_id: the id attribute of customer created previously</span>
curl https://api.balancedpayments.com/cards/:card_id <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -X PUT <span class="se">\</span>
     -d <span class="s2">&quot;customer=/customers/:customer_id&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$buyer</span> <span class="o">=</span> <span class="nv">$marketplace</span><span class="o">-&gt;</span><span class="na">customers</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;John Buyer&quot;</span>
<span class="p">));</span>

<span class="nv">$card</span> <span class="o">=</span> <span class="nx">Balanced\Marketplace</span><span class="o">::</span><span class="na">mine</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cards</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;expiration_month&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expiration_year&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;2020&quot;</span><span class="p">,</span>
    <span class="s2">&quot;number&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;5105105105105100&quot;</span><span class="p">,</span>
    <span class="s2">&quot;security_code&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$card</span><span class="o">-&gt;</span><span class="na">associateToCustomer</span><span class="p">(</span><span class="nv">$buyer</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Next, create an <span class="docutils literal"><code>Order</code></span>.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">create_order</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">create_order</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># customer_id: the id of the customer previously created</span>
curl https://api.balancedpayments.com/customers/:customer_id/orders <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;description=Order #12341234&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span> <span class="o">=</span> <span class="nv">$merchant</span><span class="o">-&gt;</span><span class="na">orders</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>At this point we have a merchant <span class="docutils literal"><code>Customer</code></span> with a bank account, a buyer
<cite>Customer</cite> with a credit card, and an &quot;empty&quot; <span class="docutils literal"><code>Order</code></span>.</p>
<p>Let's give the order a description and some meta so it's easier to remember
what it was for. Of course, this information can also be specified when creating
and Order.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Item description&#39;</span>
<span class="n">order</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;item_url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://neatitems.com/12342134123&#39;</span>
<span class="p">}</span>
<span class="n">order</span><span class="o">.</span><span class="n">save</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;Item description&#39;</span>
<span class="n">order</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&#39;item_url&#39;</span><span class="p">:</span> <span class="s">&#39;https://neatitems.com/12342134123&#39;</span>
<span class="p">}</span>
<span class="n">order</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># order_id: the id from a previously created order</span>
curl https://api.balancedpayments.com/orders/:order_id <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -X PUT <span class="se">\</span>
     -d <span class="s2">&quot;description=Item description&quot;</span> <span class="se">\</span>
     -d <span class="s2">&quot;meta[item_url]=https://neatitems.com/12342134123&quot;</span> <span class="se">\</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="s1">&#39;New description for order&#39;</span><span class="p">;</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">meta</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;anykey&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;valuegoeshere&quot;</span><span class="p">,</span>
    <span class="s2">&quot;product.id&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
<span class="p">);</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Let's debit the buyer for this Order. This is accomplished by debiting a
specific card, in this case, the buyer's, through the Order.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">debit</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">debit_from</span><span class="p">(</span>
  <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="n">card</span><span class="p">,</span>
  <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">10000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">debit</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">debit_from</span><span class="p">(</span>
  <span class="n">source</span><span class="o">=</span><span class="n">card</span><span class="p">,</span>
  <span class="n">amount</span><span class="o">=</span><span class="mi">10000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># debit to the order</span>
<span class="c"># card_id: the id of a card from the Customer to be charged</span>
<span class="c"># ORDER_HREF: the id of the order to which the debit will be associated</span>
curl https://api.balancedpayments.com/cards/:card_id/debits <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;amount=10000&quot;</span>
     -d <span class="s2">&quot;order=ORDER_HREF&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">debitFrom</span><span class="p">(</span>
    <span class="nv">$card</span><span class="p">,</span>
    <span class="s1">&#39;10000&#39;</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>At this point, if we inspect the Order, we'll see it now has an <span class="docutils literal"><code>amount</code></span> of
10000 and an escrowed amount of 10000. <cite>amount</cite> is the total amount of the
Order. <span class="docutils literal"><code>amount_escrowed</code></span> is the amount available for issuing payouts.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">reload</span> <span class="c1"># reload the order to get recent changes</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount_escrowed</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">reload</span> <span class="c"># reload the order to get recent changes</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount_escrowed</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># order_id: the id of the previously created order</span>
curl https://api.balancedpayments.com/orders/:order_id <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE:

<span class="c"># examine amount_escrowed attribute</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1"># $order_href is the stored href for the Order</span>
<span class="nv">$order</span> <span class="o">=</span> <span class="nx">Balanced\Order</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$order_href</span><span class="p">);</span> <span class="c1"># get the order object to get recent changes</span>

<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">amount</span><span class="p">;</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">amount_escrowed</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Let's issue a payout (credit) to our merchant.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">credit_to</span><span class="p">(</span>
  <span class="ss">:destination</span> <span class="o">=&gt;</span> <span class="n">bank_account</span><span class="p">,</span>
  <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">8000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">credit_to</span><span class="p">(</span>
  <span class="n">destination</span><span class="o">=</span><span class="n">bank_account</span><span class="p">,</span>
  <span class="n">amount</span><span class="o">=</span><span class="mi">8000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># credit from the order</span>
<span class="c"># bank_account_id: the id of a bank_account to be credited</span>
curl https://api.balancedpayments.com/bank_accounts/:bank_account_id/credits <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE: <span class="se">\</span>
     -d <span class="s2">&quot;amount=8000&quot;</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">creditTo</span><span class="p">(</span>
    <span class="nv">$bank_account</span><span class="p">,</span>
    <span class="s1">&#39;8000&#39;</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Now when inspecting the order object we'll see it still has an <span class="docutils literal"><code>amount</code></span> of 10000
and <span class="docutils literal"><code>amount_escrowed</code></span> is now 2000.</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">reload</span> <span class="c1"># reload the order to get recent changes</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount_escrowed</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">reload</span> <span class="c"># reload the order to get recent changes</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount</span>
<span class="n">order</span><span class="o">.</span><span class="n">amount_escrowed</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># order_id: the id of the previously created order</span>
curl https://api.balancedpayments.com/orders/:order_id <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE:

<span class="c"># examine amount_escrowed attribute</span>
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1"># $order_href is the stored href for the Order</span>
<span class="nv">$order</span> <span class="o">=</span> <span class="nx">Balanced\Order</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$order_href</span><span class="p">);</span> <span class="c1"># get the order object to get recent changes</span>

<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">amount</span><span class="p">;</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">amount_escrowed</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>We can now retrieve all of the order's debits with:</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">debits</span> <span class="c1"># instance of Balanced::Pager. Lazily iterate as an array.</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">debits</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># order_id: the id of the previously created order</span>
curl https://api.balancedpayments.com/orders/:order_id/debits <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE:
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">debits</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>Likewise, we can retrieve all of the order's credits with:</p>
<div class="section-ruby">
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">credits</span> <span class="c1"># instance of Balanced::Pager. Lazily iterate as an array.</span>
</pre></div>
</div>
</div>
<div class="section-python">
<div class="highlight-python"><div class="highlight"><pre><span class="n">order</span><span class="o">.</span><span class="n">credits</span>
</pre></div>
</div>
</div>
<div class="section-bash">
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># order_id: the id of the previously created order</span>
curl https://api.balancedpayments.com/orders/:order_id/credits <span class="se">\</span>
     -H <span class="s2">&quot;Accept-Type: application/vnd.api+json;revision=1.1&quot;</span> <span class="se">\</span>
     -u ak-test-1sKqYrBZG6WYpHphDAsM7ZXFEmJlAn1GE:
</pre></div>
</div>
</div>
<div class="section-php">
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$order</span><span class="o">-&gt;</span><span class="na">credits</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<section id="checkpoint">
<h2>Checkpoint<a class="headerlink" href="#checkpoint" title="Permalink to this headline">∵</a></h2>
<p>You should understand how to do following:</p>
<ul class="list-noindent simple">
<li>✓ Create a <span class="docutils literal"><code>Customer</code></span> representing a seller (merchant) and associate a <span class="docutils literal"><code>BankAccount1</code></span> to it.</li>
<li>✓ Create a <span class="docutils literal"><code>Customer</code></span> representing a buyer and associate a <span class="docutils literal"><code>BankAccount</code></span> to it.</li>
<li>✓ Create an <span class="docutils literal"><code>Order</code></span></li>
<li>✓ Update an <span class="docutils literal"><code>Order</code></span></li>
<li>✓ Create an order debit</li>
<li>✓ Check the order <span class="docutils literal"><code>amount</code></span></li>
<li>✓ Check the order <span class="docutils literal"><code>amount_escrowed</code></span></li>
<li>✓ Issue a credit from an <span class="docutils literal"><code>Order</code></span> to a seller</li>
<li>✓ Issue a credit from an <span class="docutils literal"><code>Order</code></span> to the marketplace bank account</li>
</ul>
</section></section>
</div>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/compiled.js"></script>
  </body>
</html>